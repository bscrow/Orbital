{"ast":null,"code":"import _objectSpread from \"C:\\\\Users\\\\Lenovo\\\\Desktop\\\\Orbital\\\\Orbital-master\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread\";\nvar _jsxFileName = \"C:\\\\Users\\\\Lenovo\\\\Desktop\\\\Orbital\\\\Orbital-master\\\\src\\\\Components\\\\Planning\\\\Timeline\\\\Timeline.js\";\nimport React from 'react';\nimport Topbar from './Topbar';\nimport { Graph } from 'react-d3-graph';\nimport { myConfig } from '../Graph/GraphConfig';\nimport { Spinner, Label, Modal, Form, FormGroup, Input, Row, Col, ModalHeader, ModalBody, ModalFooter, Container, Button, Table } from 'reactstrap';\nimport CustomNode from '../Graph/CustomNode';\nimport fb from '../../Config/config';\n\nconst moduleDatabase = require('../../Data/modata.json');\n\nclass Timeline extends React.Component {\n  constructor() {\n    super();\n\n    this.onClickNode = id => {\n      var obj = null;\n\n      for (var i = 0; i < this.state.data2.nodes.length; i = i + 1) {\n        if (this.state.data2.nodes[i].id === id) {\n          obj = this.state.data2.nodes[i];\n          break;\n        }\n      }\n\n      var willDisplayModal = true;\n\n      for (var i = 0; i < obj.require.length; i = i + 1) {\n        if (!obj.require[i].unlocked) {\n          willDisplayModal = false;\n          break;\n        }\n      }\n\n      if (!willDisplayModal) {\n        this.setState(prevState => {\n          return _objectSpread({}, prevState, {\n            showSpecialModal: obj\n          });\n        });\n      } else {\n        this.setState(prevState => {\n          return {\n            data: prevState.data,\n            showModal: obj,\n            showTimeline: false,\n            showSidebar: false,\n            config: prevState.config,\n            data2: prevState.data2\n          };\n        });\n      }\n    };\n\n    const config = myConfig;\n    var tempState = {\n      data: null,\n      showModal: false,\n      showTimeline: false,\n      showSidebar: false,\n      config,\n      data2: null,\n      addedList: [],\n      isLoading: true,\n      showSpecialModal: null,\n      usefulTemp: []\n    };\n    this.state = tempState;\n    this.addToTimeline = this.addToTimeline.bind(this);\n    this.removeFromTimeline = this.removeFromTimeline.bind(this);\n    this.removeFromTimeline2 = this.removeFromTimeline2.bind(this);\n    this.drawTable = this.drawTable.bind(this);\n    this.drawEmptyCell = this.drawEmptyCell.bind(this);\n    this.findModule = this.findModule.bind(this);\n    this.toggleTimeline = this.toggleTimeline.bind(this);\n    this.drawGraph = this.drawGraph.bind(this);\n    this.showModal = this.showModal.bind(this);\n    this.generateButtons = this.generateButtons.bind(this);\n    this.modalButton = this.modalButton.bind(this);\n    this.toggleModal = this.toggleModal.bind(this);\n    this.showEditForm = this.showEditForm.bind(this);\n    this.handleOnChangeEditForm = this.handleOnChangeEditForm.bind(this);\n    this.openNUSMODS = this.openNUSMODS.bind(this);\n    this.specialToggle = this.specialToggle.bind(this);\n    this.showSpecialModal = this.showSpecialModal.bind(this);\n    this.specialModalButton = this.specialModalButton.bind(this);\n    this.handleSpecialChange = this.handleSpecialChange.bind(this);\n  }\n\n  componentDidMount() {\n    var database = fb.firestore();\n    const email = fb.auth().currentUser.email;\n    var graphData = database.collection('users').doc(email).get().then(doc => {\n      if (!doc.exists) {\n        console.log('No such document in database');\n      } else {\n        this.setState(prevState => {\n          return _objectSpread({}, prevState, {\n            data2: doc.data().graphData,\n            isLoading: false,\n            data: doc.data().timelineData\n          });\n        });\n      }\n    }).catch(err => {\n      console.log('Error getting document');\n    });\n  }\n\n  specialToggle() {\n    this.setState(prevState => {\n      return _objectSpread({}, prevState, {\n        showSpecialModal: null,\n        usefulTemp: []\n      });\n    });\n  }\n\n  specialModalButton(obj, event) {\n    event.preventDefault();\n\n    for (var exempted of this.state.usefulTemp) {\n      var done = false;\n\n      for (var node of this.state.data2.nodes) {\n        if (done) {\n          break;\n        } else if (node.id === exempted) {\n          this.addToTimeline(node.id, -1, -1);\n          break;\n        } else {\n          for (var nodeEquiv of node.equivalent) {\n            if (nodeEquiv === exempted) {\n              this.addToTimeline(node.id, -1, -1);\n              done = true;\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    this.setState(prevState => {\n      return _objectSpread({}, prevState, {\n        showSpecialModal: null,\n        usefulTemp: []\n      });\n    });\n  }\n\n  handleSpecialChange(event) {\n    const name = event.target.name;\n    const checked = event.target.checked;\n\n    if (checked) {\n      this.setState(prevState => {\n        var newUsefulTemp = prevState.usefulTemp;\n        newUsefulTemp.push(name);\n        return _objectSpread({}, prevState, {\n          usefulTemp: newUsefulTemp\n        });\n      });\n    } else {\n      this.setState(prevState => {\n        const nameToBeRemoved = name;\n        var newUsefulTemp = [];\n\n        for (var n of prevState.usefulTemp) {\n          if (n !== nameToBeRemoved) {\n            newUsefulTemp.push(n);\n          }\n        }\n\n        return _objectSpread({}, prevState, {\n          usefulTemp: newUsefulTemp\n        });\n      });\n    }\n\n    console.log(event.target.name);\n    console.log(event.target.checked);\n  }\n\n  showSpecialModal(obj) {\n    const required = [];\n    var counter = 0;\n\n    for (var req of obj.require) {\n      if (!req.unlocked) {\n        var temp = \"Any one of: \";\n\n        for (var i = 0; i < req.name.length; i = i + 1) {\n          if (i != req.name.length - 1) {\n            temp = temp + req.name[i] + \", \";\n          } else {\n            temp = temp + req.name[i];\n          }\n        }\n\n        const htmlLayout = React.createElement(FormGroup, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 151\n          },\n          __self: this\n        }, React.createElement(Label, {\n          style: {\n            marginLeft: '20px'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 152\n          },\n          __self: this\n        }, React.createElement(Input, {\n          type: \"checkbox\",\n          name: req.name[0],\n          onChange: e => this.handleSpecialChange(e),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 153\n          },\n          __self: this\n        }), temp));\n        required.push(htmlLayout);\n        counter = counter + 1;\n      }\n    }\n\n    return React.createElement(Form, {\n      style: {\n        margin: '30px',\n        textAlign: 'justify'\n      },\n      onSubmit: e => this.specialModalButton(obj, e),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162\n      },\n      __self: this\n    }, React.createElement(FormGroup, {\n      style: {\n        fontWeight: 'bold',\n        fontSize: '18px'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163\n      },\n      __self: this\n    }, obj.id + \" - \" + obj.name), React.createElement(FormGroup, {\n      style: {\n        fontWeight: 'bold',\n        fontSize: '15px'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164\n      },\n      __self: this\n    }, \"You have not unlocked all of the prerequisites for this module. To make an exception, select the module(s) from the following options that you have cleared or are exempted from. (E.g some ES modules)\"), required, React.createElement(FormGroup, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169\n      },\n      __self: this\n    }, React.createElement(Button, {\n      type: \"submit\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170\n      },\n      __self: this\n    }, \"Make this exception for me!\")));\n  }\n\n  toggleTimeline() {\n    this.setState(prevState => {\n      return _objectSpread({}, prevState, {\n        data: prevState.data,\n        showModal: false,\n        showTimeline: !prevState.showTimeline,\n        showSidebar: false,\n        addedList: prevState.addedList,\n        data2: prevState.data2\n      });\n    });\n  } //Draws an empty cell containing a message (acts as a placeholder when timeline is empty)\n\n\n  drawEmptyCell(msg) {\n    const regex = /(NOC)|(Exchange)/g;\n    const finalizedMsg = msg === undefined ? undefined : regex.test(msg) ? msg : msg + \" - \" + moduleDatabase[msg].name;\n    return React.createElement(\"div\", {\n      class: msg === undefined ? \"cellBefore\" : regex.test(msg) ? \"cellSp\" : \"cellAfter\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194\n      },\n      __self: this\n    }, msg === undefined ? \"-Empty-\" : finalizedMsg);\n  } //Adds <String> module, <Integer> year, <Integer> semester to the timeline\n\n\n  addToTimeline(module, year, semester) {\n    this.setState(prevState => {\n      var updatedSemesterYear = 'y' + year + 's' + semester;\n      var updatedList = prevState.addedList.map(x => x);\n      updatedList.push(module);\n\n      for (var i = 0; i < prevState.data2.nodes.length; i = i + 1) {\n        if (prevState.data2.nodes[i].id === module) {\n          prevState.data2.nodes[i].added = [year, semester];\n        }\n\n        var updateUnlock = prevState.data2.nodes[i].require;\n\n        for (var k = 0; k < updateUnlock.length; k = k + 1) {\n          for (var p = 0; p < updateUnlock[k].name.length; p = p + 1) {\n            if (updateUnlock[k].name[p] === module) {\n              updateUnlock[k].unlocked = true;\n              break;\n            }\n          }\n        }\n      }\n\n      var newState = {\n        data: {},\n        addedList: updatedList,\n        showTimeline: prevState.showTimeline,\n        data2: prevState.data2\n      };\n\n      for (var i = 1; i <= 4; i = i + 1) {\n        for (var j = 1; j <= 2; j = j + 1) {\n          var semesterYear = 'y' + i + 's' + j;\n\n          if (semesterYear === updatedSemesterYear) {\n            newState.data[semesterYear] = prevState.data[semesterYear].map(x => x);\n            newState.data[semesterYear].push(module);\n          } else {\n            newState.data[semesterYear] = prevState.data[semesterYear].map(x => x);\n          }\n        }\n      }\n\n      return newState;\n    });\n  } //Removes <Object> module from the timeline\n\n\n  removeFromTimeline2(moduleObj) {\n    const moduleName = moduleObj.module;\n    const year = moduleObj.added[0];\n    const sem = moduleObj.added[1];\n    this.setState(prevState => {\n      var yearSem = 'y' + year + 's' + sem;\n      var newData = [];\n\n      for (var i = 0; i < this.state.data[yearSem].length; i = i + 1) {\n        if (this.state.data[yearSem][i] !== moduleName) {\n          newData.push(this.state.data[yearSem][i]);\n        }\n      }\n\n      this.state.data[yearSem] = newData;\n      return _objectSpread({}, prevState, {\n        data: this.state.data\n      });\n    });\n  } //Removes <String> module from the timeline\n\n\n  removeFromTimeline(module) {\n    var moduleObject = null;\n\n    for (var i = 0; i < this.state.data2.nodes.length; i = i + 1) {\n      if (this.state.data2.nodes[i].id === module) {\n        moduleObject = this.state.data2.nodes[i];\n        break;\n      }\n    }\n\n    if (moduleObject.added[0] === 0) {\n      //Not in the timeline\n      return;\n    } else {\n      moduleObject.added = [0, 0];\n      this.setState(prevState => {\n        var updatedList = [];\n\n        for (var h = 0; h < prevState.data2.nodes.length; h = h + 1) {\n          var updateUnlock = prevState.data2.nodes[h].require;\n\n          for (var j = 0; j < updateUnlock.length; j = j + 1) {\n            for (var k = 0; k < updateUnlock[j].name.length; k = k + 1) {\n              if (updateUnlock[j].name[k] === module) {\n                updateUnlock[j].unlocked = false;\n                break;\n              }\n            }\n          }\n        }\n\n        for (var i = 0; i < prevState.addedList.length; i = i + 1) {\n          if (!(prevState.addedList[i] === module)) {\n            updatedList.push(prevState.addedList[i]);\n          }\n        }\n\n        prevState.data2.module = false;\n\n        var newState = _objectSpread({}, prevState, {\n          data: {},\n          showTimeline: prevState.showTimeline,\n          addedList: updatedList,\n          data2: prevState.data2,\n          showModal: false\n        });\n\n        for (var i = 1; i <= 4; i = i + 1) {\n          for (var j = 1; j <= 2; j = j + 1) {\n            var semesterYear = 'y' + i + 's' + j;\n            var k = 0;\n            var temp = [];\n\n            while (k < prevState.data[semesterYear].length) {\n              if (!(prevState.data[semesterYear][k] === module)) {\n                temp.push(prevState.data[semesterYear][k]);\n              }\n\n              k++;\n            }\n\n            newState.data[semesterYear] = temp;\n          }\n        }\n\n        return newState;\n      });\n\n      for (var t = 0; t < this.state.data2.links.length; t = t + 1) {\n        if (this.state.data2.links[t].source === module) {\n          this.removeFromTimeline(this.state.data2.links[t].target);\n        }\n      }\n    }\n  } //Finds and return the year and sem in the timeline returns: [year, semester]\n\n\n  findModule(module) {\n    var result = [null, null];\n\n    for (var i = 1; i <= 4; i = i + 1) {\n      for (var j = 1; j <= 2; j = j + 1) {\n        const semesterYear = 'y' + i + 's' + j;\n\n        for (var k = 0; k < this.state.data[semesterYear].length; k = k + 1) {\n          if (this.state.data[semesterYear][k] === module) {\n            result[0] = i;\n            result[1] = j;\n          }\n        }\n      }\n    }\n\n    return result;\n  } //Modals\n\n\n  modalButton(module, year, semester) {\n    this.setState(prevState => {\n      return _objectSpread({}, prevState, {\n        data: prevState.data,\n        showModal: false,\n        showTimeline: false,\n        showSidebar: false,\n        config: prevState.config,\n        data2: prevState.data2,\n        addedList: prevState.addedList\n      });\n    });\n    this.addToTimeline(module, year, semester);\n    console.log(module, ' is added to year ' + year + ' sem ' + semester);\n  }\n\n  toggleModal() {\n    this.setState(prevState => {\n      return _objectSpread({}, prevState, {\n        data: prevState.data,\n        showModal: !prevState.showModal,\n        showTimeline: false,\n        showSidebar: false,\n        config: prevState.config,\n        data2: prevState.data2,\n        addedList: prevState.addedList\n      });\n    });\n  }\n\n  showEditForm(obj) {\n    const equivalentModules = obj.equivalent.map(mod => {\n      return React.createElement(\"option\", {\n        value: mod,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 364\n        },\n        __self: this\n      }, mod);\n    });\n    return React.createElement(Form, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 368\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 369\n      },\n      __self: this\n    }, \"Not taking \" + obj.id + \"? Pick another equivalent module:\", \" \", React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 370\n      },\n      __self: this\n    })), React.createElement(Input, {\n      type: \"select\",\n      value: obj.id,\n      onChange: e => this.handleOnChangeEditForm(obj, e),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 372\n      },\n      __self: this\n    }, equivalentModules));\n  }\n\n  handleOnChangeEditForm(object, event) {\n    //Must create constant to store value of event.target.value because it is asynchronous\n    const updatedName = event.target.value;\n    var modalObj = null;\n    this.setState(prevState => {\n      var updatedData = {\n        nodes: prevState.data2.nodes.map(x => x),\n        links: prevState.data2.links.map(x => x)\n      };\n\n      for (var i = 0; i < updatedData.nodes.length; i = i + 1) {\n        if (updatedData.nodes[i].id === object.id) {\n          updatedData.nodes[i] = {\n            id: updatedName,\n            x: updatedData.nodes[i].x,\n            y: updatedData.nodes[i].y,\n            equivalent: updatedData.nodes[i].equivalent,\n            require: updatedData.nodes[i].require,\n            added: [0, 0],\n            name: updatedData.nodes[i].name\n          };\n          modalObj = updatedData.nodes[i];\n          break;\n        }\n      }\n\n      for (var i = 0; i < updatedData.links.length; i = i + 1) {\n        if (updatedData.links[i].source === object.id) {\n          updatedData.links[i] = {\n            source: updatedName,\n            target: updatedData.links[i].target\n          };\n        } else if (updatedData.links[i].target === object.id) {\n          updatedData.links[i] = {\n            source: updatedData.links[i].source,\n            target: updatedName\n          };\n        }\n      }\n\n      return _objectSpread({}, prevState, {\n        data: prevState.data,\n        showModal: modalObj,\n        showTimeline: false,\n        showSidebar: false,\n        config: prevState.config,\n        data2: updatedData,\n        addedList: prevState.addedList\n      });\n    });\n  } //Helper function to generate buttons for showModal(obj)\n\n\n  generateButtons(yearSem, module) {\n    const result = [];\n    var flag = (yearSem[0] - 1) * 2 + yearSem[1];\n    var counter = 1;\n    var spProgram = [];\n    Object.keys(this.state.data).forEach(key => {\n      const regex = /(NOC)|(Exchange)/;\n\n      if (regex.test(this.state.data[key][0])) {\n        spProgram.push(key);\n      }\n    });\n\n    for (var i = 1; i <= 4; i = i + 1) {\n      for (var j = 1; j <= 2; j = j + 1) {\n        const ys = 'y' + i + 's' + j;\n\n        if (counter > flag && !spProgram.includes(ys)) {\n          //show clickable button\n          const year = i;\n          const sem = j;\n          const btn = React.createElement(Button, {\n            onClick: () => this.modalButton(module, year, sem),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 445\n            },\n            __self: this\n          }, \"Year \" + year + \" Sem \" + sem);\n          result.push(btn);\n        } else {\n          const year = i;\n          const sem = j;\n          const btn = React.createElement(Button, {\n            disabled: true,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 450\n            },\n            __self: this\n          }, \"Year \" + year + \" Sem \" + sem);\n          result.push(btn);\n        }\n\n        counter = counter + 1;\n      }\n    }\n\n    return result;\n  }\n\n  showModal(obj) {\n    const module = obj.id;\n    var latestPrereqYearSem = [0, 0];\n\n    for (var k = 0; k < obj.require.length; k = k + 1) {\n      var preReqList = obj.require[k];\n\n      for (var j = 0; j < preReqList.name.length; j = j + 1) {\n        var preReq = preReqList.name[j];\n\n        for (var i = 0; i < this.state.data2.nodes.length; i = i + 1) {\n          var moduleObj = this.state.data2.nodes[i];\n\n          if (moduleObj.id === preReq) {\n            console.log(moduleObj.id, ' added to ', moduleObj.added);\n            const yearSemAdded = moduleObj.added;\n            latestPrereqYearSem = latestPrereqYearSem[0] > yearSemAdded[0] ? latestPrereqYearSem : latestPrereqYearSem[0] < yearSemAdded[0] ? yearSemAdded : latestPrereqYearSem[1] > yearSemAdded[1] ? latestPrereqYearSem : yearSemAdded;\n            break;\n          }\n        }\n      }\n    }\n\n    console.log(latestPrereqYearSem);\n\n    if (obj.added[0] === 0) {\n      return React.createElement(\"div\", {\n        class: \"modal-content\",\n        id: \"myModal\" + obj.id,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 482\n        },\n        __self: this\n      }, React.createElement(ModalHeader, {\n        toggle: this.toggleModal,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 483\n        },\n        __self: this\n      }, obj.id + ' - ' + obj.name), React.createElement(\"div\", {\n        class: \"modal-msg\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 484\n        },\n        __self: this\n      }, this.showEditForm(obj)), React.createElement(Container, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 487\n        },\n        __self: this\n      }, React.createElement(Row, {\n        className: \"Info\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 488\n        },\n        __self: this\n      }, React.createElement(Col, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 489\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        class: \"modalMoreInfo\",\n        onClick: () => this.openNUSMODS(obj),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 490\n        },\n        __self: this\n      }, \"Get more information about this module here!\")), React.createElement(Col, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 494\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          marginBottom: 10\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 495\n        },\n        __self: this\n      }, \"Add \" + module + \" to?\"), React.createElement(\"div\", {\n        class: \"modalButtons\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 496\n        },\n        __self: this\n      }, this.generateButtons(latestPrereqYearSem, module))))));\n    } else {\n      const future = [];\n\n      for (var link of this.state.data2.links) {\n        if (link.source === obj.id) {\n          future.push(link.target);\n        }\n      }\n\n      var ys = [];\n\n      for (var futureMod of future) {\n        for (var node of this.state.data2.nodes) {\n          if (node.id === futureMod) {\n            const futureAdd = node.added;\n\n            if (futureAdd[0] !== 0) {\n              ys.push(futureAdd);\n            }\n          }\n        }\n      }\n\n      var buttonRes = [5, 5];\n\n      if (ys.length > 0) {\n        for (var addedPeriod of ys) {\n          buttonRes = buttonRes[0] > addedPeriod[0] ? addedPeriod : buttonRes[0] === addedPeriod[0] ? buttonRes[1] > addedPeriod[1] ? addedPeriod : buttonRes : buttonRes;\n        }\n      }\n\n      var buttons = [];\n      var marked = false;\n      const regex = /(NOC)|(Exchange)/;\n\n      for (var i = 1; i <= 4; i = i + 1) {\n        for (var j = 1; j <= 2; j = j + 1) {\n          const yrSem = 'y' + i + 's' + j;\n          console.log(yrSem + ' ' + this.state.data[yrSem][0]);\n\n          if (marked || regex.test(this.state.data[yrSem][0])) {\n            const btn = React.createElement(Button, {\n              disabled: true,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 539\n              },\n              __self: this\n            }, \"Year \" + i + \" Sem \" + j);\n            buttons.push(btn);\n          } else {\n            if (i === buttonRes[0] && j === buttonRes[1]) {\n              marked = true;\n              const btn = React.createElement(Button, {\n                disabled: true,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 544\n                },\n                __self: this\n              }, \"Year \" + i + \" Sem \" + j);\n              buttons.push(btn);\n            } else {\n              const year = i;\n              const sem = j;\n\n              const btnFunc = () => {\n                const modObj = {\n                  module: obj.id,\n                  added: obj.added\n                };\n                this.removeFromTimeline2(modObj);\n                this.addToTimeline(obj.id, year, sem);\n                this.setState(prevState => {\n                  return _objectSpread({}, prevState, {\n                    showModal: false\n                  });\n                });\n              };\n\n              const btn = React.createElement(Button, {\n                onClick: btnFunc,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 563\n                },\n                __self: this\n              }, \"Year \" + i + \" Sem \" + j);\n              buttons.push(btn);\n            }\n          }\n        }\n      }\n\n      return React.createElement(\"div\", {\n        class: \"modal-content\",\n        id: \"myModal\" + obj.id,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 569\n        },\n        __self: this\n      }, React.createElement(ModalHeader, {\n        toggle: this.toggleModal,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 570\n        },\n        __self: this\n      }, obj.id + ' - ' + obj.name), React.createElement(ModalBody, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 571\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 572\n        },\n        __self: this\n      }, obj.added[0] === -1 ? \"You are exempted/ have cleared this module requirement. Do you want to remove your exemption?\" : \"Remove \" + obj.id + \" from year \" + obj.added[0] + \" semester \" + obj.added[1] + \"?\"), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 573\n        },\n        __self: this\n      }, \"WARNING: any modules that require \" + obj.id + \" will be removed from the timeline as well!\"), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 574\n        },\n        __self: this\n      }, \"Alternatively you can change the timeline slot for \" + obj.id)), React.createElement(ModalFooter, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 576\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          display: 'grid',\n          gridTemplateColumns: '1fr 1fr',\n          width: '100%',\n          alignItems: 'center'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 577\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 578\n        },\n        __self: this\n      }, \"Remove module? \", React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 578\n        },\n        __self: this\n      }), React.createElement(Button, {\n        style: {\n          marginTop: '10px'\n        },\n        onClick: () => this.removeFromTimeline(obj.id),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 578\n        },\n        __self: this\n      }, \"Remove\")), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 579\n        },\n        __self: this\n      }, \"Change to which year/sem?\", React.createElement(\"div\", {\n        style: {\n          marginTop: '10px',\n          display: 'grid',\n          gridTemplateColumns: '1fr 1fr',\n          width: '100%',\n          gridGap: '7px'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 581\n        },\n        __self: this\n      }, buttons)))));\n    }\n  }\n\n  openNUSMODS(obj) {\n    const url = \"https://nusmods.com/modules/\" + obj.id;\n    window.open(url);\n  }\n\n  drawTable(year) {\n    const yearSem1 = \"y\" + year + \"s\" + 1;\n    const yearSem2 = \"y\" + year + \"s\" + 2;\n    const regex = /(NOC)|(Exchange)/;\n    const spProgStyles = {\n      verticalAlign: 'middle',\n      fontSize: '50px',\n      fontWeight: 'bolder'\n    };\n    const rowSpanSize = this.state.data[yearSem1].length > this.state.data[yearSem2].length ? this.state.data[yearSem1].length > 5 ? this.state.data[yearSem1].length : 5 : this.state.data[yearSem2].length > 5 ? this.state.data[yearSem2].length : 5;\n\n    if (regex.test(this.state.data[yearSem1][0]) && regex.test(this.state.data[yearSem2][0])) {\n      //Entire year which user will be or have went to special programmes (NOC/Exchange)\n      return [React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 610\n        },\n        __self: this\n      }, React.createElement(\"th\", {\n        style: {\n          verticalAlign: 'middle'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 611\n        },\n        __self: this\n      }, \"Year \" + year), React.createElement(\"td\", {\n        style: spProgStyles,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 612\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem1][0])), React.createElement(\"td\", {\n        style: spProgStyles,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 613\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem2][0])))];\n    } else if (regex.test(this.state.data[yearSem1][0])) {\n      //sem1 of the year which user will be or have went to special programmes (NOC/Exchange)\n      var result = [React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 618\n        },\n        __self: this\n      }, React.createElement(\"th\", {\n        style: {\n          verticalAlign: 'middle'\n        },\n        rowSpan: rowSpanSize,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 619\n        },\n        __self: this\n      }, \"Year \" + year), React.createElement(\"td\", {\n        style: spProgStyles,\n        rowSpan: rowSpanSize,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 620\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem1][0])), React.createElement(\"td\", {\n        style: {\n          verticalAlign: 'middle'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 621\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem2][0]))), React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 623\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 624\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem2][1]))), React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 626\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 627\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem2][2]))), React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 629\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 630\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem2][3]))), React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 632\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 633\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem2][4])))];\n\n      for (var i = 5; i < rowSpanSize; i = i + 1) {\n        const tableRow = React.createElement(\"tr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 637\n          },\n          __self: this\n        }, React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 638\n          },\n          __self: this\n        }, this.drawEmptyCell(this.state.data[yearSem2][i])));\n        result.push(tableRow);\n      }\n\n      return result;\n    } else if (regex.test(this.state.data[yearSem2][0])) {\n      //sem2 of the year which user will be or have went to special programmes (NOC/Exchange)\n      var result = [React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 645\n        },\n        __self: this\n      }, React.createElement(\"th\", {\n        style: {\n          verticalAlign: 'middle'\n        },\n        rowSpan: rowSpanSize,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 646\n        },\n        __self: this\n      }, \"Year \" + year), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 647\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem1][0])), React.createElement(\"td\", {\n        style: spProgStyles,\n        rowSpan: rowSpanSize,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 648\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem2][0]))), React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 650\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 651\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem1][1]))), React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 653\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 654\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem1][2]))), React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 656\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 657\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem1][3]))), React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 659\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 660\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem1][4])))];\n\n      for (var i = 5; i < rowSpanSize; i = i + 1) {\n        const tableRow = React.createElement(\"tr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 665\n          },\n          __self: this\n        }, React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 666\n          },\n          __self: this\n        }, this.drawEmptyCell(this.state.data[yearSem1][i])));\n        result.push(tableRow);\n      }\n\n      return result;\n    } else {\n      var result = [React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 672\n        },\n        __self: this\n      }, React.createElement(\"th\", {\n        style: {\n          verticalAlign: 'middle'\n        },\n        rowSpan: rowSpanSize,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 673\n        },\n        __self: this\n      }, \"Year \" + year), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 674\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem1][0])), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 675\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem2][0]))), React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 677\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 678\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem1][1])), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 679\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem2][1]))), React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 681\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 682\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem1][2])), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 683\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem2][2]))), React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 685\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 686\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem1][3])), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 687\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem2][3]))), React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 689\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 690\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem1][4])), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 691\n        },\n        __self: this\n      }, this.drawEmptyCell(this.state.data[yearSem2][4])))];\n\n      for (var i = 5; i < rowSpanSize; i = i + 1) {\n        const tableRow = React.createElement(\"tr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 695\n          },\n          __self: this\n        }, React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 696\n          },\n          __self: this\n        }, this.drawEmptyCell(this.state.data[yearSem1][i])), React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 697\n          },\n          __self: this\n        }, this.drawEmptyCell(this.state.data[yearSem2][i])));\n        result.push(tableRow);\n      }\n\n      return result;\n    }\n  }\n\n  drawGraph() {\n    this.state.config.node.viewGenerator = info => React.createElement(CustomNode, {\n      info: info,\n      addToTimeline: this.addToTimeline,\n      removeFromTimeline: this.removeFromTimeline,\n      findModule: this.findModule,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 706\n      },\n      __self: this\n    });\n    /*for (var node of this.state.data2.nodes) {\r\n        var unlocked = true;\r\n        for (var req of node.require) {\r\n            if (!req.unlocked) {\r\n                unlocked = false;\r\n            }\r\n        }\r\n        if (unlocked) {\r\n            node.size = 800;\r\n        } else {\r\n            node.size = 600;\r\n        }\r\n    }*/\n\n\n    var format = React.createElement(\"div\", {\n      class: \"MODGrid\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 720\n      },\n      __self: this\n    }, React.createElement(Graph, Object.assign({\n      ref: \"graph\"\n    }, {\n      id: \"graph\",\n      data: this.state.data2,\n      config: this.state.config,\n      onClickNode: this.onClickNode,\n      onDoubleClickNode: this.onDoubleClickNode,\n      onClickGraph: this.onClickGraph\n    }, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 721\n      },\n      __self: this\n    })));\n    return format;\n  } //User interaction with graph\n\n\n  render() {\n    const screenHeight = window.screen.height;\n    const screenWidth = window.screen.width;\n    return React.createElement(\"div\", {\n      class: this.props.className,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 775\n      },\n      __self: this\n    }, React.createElement(Modal, {\n      isOpen: this.state.showModal === false ? false : true,\n      toggle: this.toggleModal,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 776\n      },\n      __self: this\n    }, this.state.showModal === false ? null : this.showModal(this.state.showModal)), React.createElement(Modal, {\n      isOpen: this.state.showSpecialModal === null ? false : true,\n      toggle: this.specialToggle,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 779\n      },\n      __self: this\n    }, this.state.showSpecialModal === null ? null : this.showSpecialModal(this.state.showSpecialModal)), React.createElement(Topbar, {\n      toggleTimeline: this.toggleTimeline,\n      graphData: this.state.data2,\n      getTimelineData: () => this.state.data,\n      timelineData: this.state.data,\n      addToTimeline: this.addToTimeline,\n      removeFromTimeline: this.removeFromTimeline2,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 782\n      },\n      __self: this\n    }), this.state.isLoading ? null //(<div style={{display: 'flex', alignItems: 'center'}}><Spinner style={{ width: '100px', height: '100px' }} color=\"light\" /></div>)\n    : React.createElement(\"div\", {\n      class: \"MODGrid\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 784\n      },\n      __self: this\n    }, this.drawGraph()), React.createElement(Modal, {\n      isOpen: this.state.showTimeline,\n      overlayClassName: \"modal-bg\",\n      toggle: this.toggleTimeline,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 787\n      },\n      __self: this\n    }, this.state.showTimeline ? React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 790\n      },\n      __self: this\n    }, React.createElement(Table, {\n      dark: true,\n      striped: true,\n      size: \"sm\",\n      bordered: true,\n      style: {\n        margin: 0\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 791\n      },\n      __self: this\n    }, React.createElement(\"thead\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 792\n      },\n      __self: this\n    }, React.createElement(\"tr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 793\n      },\n      __self: this\n    }, React.createElement(\"th\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 794\n      },\n      __self: this\n    }, \"Timeline\"), React.createElement(\"th\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 795\n      },\n      __self: this\n    }, \"Semester 1\"), React.createElement(\"th\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 796\n      },\n      __self: this\n    }, \"Semester 2\"))), React.createElement(\"tbody\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 799\n      },\n      __self: this\n    }, this.drawTable(1), this.drawTable(2), this.drawTable(3), this.drawTable(4)))) : null));\n  }\n\n}\n\nexport default Timeline;","map":{"version":3,"sources":["C:\\Users\\Lenovo\\Desktop\\Orbital\\Orbital-master\\src\\Components\\Planning\\Timeline\\Timeline.js"],"names":["React","Topbar","Graph","myConfig","Spinner","Label","Modal","Form","FormGroup","Input","Row","Col","ModalHeader","ModalBody","ModalFooter","Container","Button","Table","CustomNode","fb","moduleDatabase","require","Timeline","Component","constructor","onClickNode","id","obj","i","state","data2","nodes","length","willDisplayModal","unlocked","setState","prevState","showSpecialModal","data","showModal","showTimeline","showSidebar","config","tempState","addedList","isLoading","usefulTemp","addToTimeline","bind","removeFromTimeline","removeFromTimeline2","drawTable","drawEmptyCell","findModule","toggleTimeline","drawGraph","generateButtons","modalButton","toggleModal","showEditForm","handleOnChangeEditForm","openNUSMODS","specialToggle","specialModalButton","handleSpecialChange","componentDidMount","database","firestore","email","auth","currentUser","graphData","collection","doc","get","then","exists","console","log","timelineData","catch","err","event","preventDefault","exempted","done","node","nodeEquiv","equivalent","name","target","checked","newUsefulTemp","push","nameToBeRemoved","n","required","counter","req","temp","htmlLayout","marginLeft","e","margin","textAlign","fontWeight","fontSize","msg","regex","finalizedMsg","undefined","test","module","year","semester","updatedSemesterYear","updatedList","map","x","added","updateUnlock","k","p","newState","j","semesterYear","moduleObj","moduleName","sem","yearSem","newData","moduleObject","h","t","links","source","result","equivalentModules","mod","object","updatedName","value","modalObj","updatedData","y","flag","spProgram","Object","keys","forEach","key","ys","includes","btn","latestPrereqYearSem","preReqList","preReq","yearSemAdded","marginBottom","future","link","futureMod","futureAdd","buttonRes","addedPeriod","buttons","marked","yrSem","btnFunc","modObj","display","gridTemplateColumns","width","alignItems","marginTop","gridGap","url","window","open","yearSem1","yearSem2","spProgStyles","verticalAlign","rowSpanSize","tableRow","viewGenerator","info","format","onDoubleClickNode","onClickGraph","render","screenHeight","screen","height","screenWidth","props","className"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport Topbar from './Topbar';\r\nimport { Graph } from 'react-d3-graph';\r\nimport { myConfig } from '../Graph/GraphConfig';\r\nimport {Spinner, Label, Modal, Form, FormGroup,Input, Row, Col, ModalHeader, ModalBody, ModalFooter, Container, Button, Table} from 'reactstrap';\r\nimport CustomNode from '../Graph/CustomNode';\r\nimport fb from '../../Config/config';\r\nconst moduleDatabase = require('../../Data/modata.json');\r\n\r\nclass Timeline extends React.Component {\r\n    constructor() {\r\n        super();\r\n        const config = myConfig;\r\n        var tempState = {\r\n            data : null,\r\n            showModal : false,\r\n            showTimeline: false,\r\n            showSidebar: false,\r\n            config,\r\n            data2: null,\r\n            addedList: [],\r\n            isLoading: true,\r\n            showSpecialModal: null,\r\n            usefulTemp: []\r\n        };  \r\n        this.state = tempState;\r\n        this.addToTimeline = this.addToTimeline.bind(this);\r\n        this.removeFromTimeline = this.removeFromTimeline.bind(this);\r\n        this.removeFromTimeline2 = this.removeFromTimeline2.bind(this);\r\n        this.drawTable = this.drawTable.bind(this);\r\n        this.drawEmptyCell = this.drawEmptyCell.bind(this);\r\n        this.findModule = this.findModule.bind(this);\r\n        this.toggleTimeline = this.toggleTimeline.bind(this);\r\n        this.drawGraph = this.drawGraph.bind(this);\r\n        this.showModal = this.showModal.bind(this);\r\n        this.generateButtons = this.generateButtons.bind(this);\r\n        this.modalButton = this.modalButton.bind(this)\r\n        this.toggleModal = this.toggleModal.bind(this)\r\n        this.showEditForm = this.showEditForm.bind(this)\r\n        this.handleOnChangeEditForm = this.handleOnChangeEditForm.bind(this)\r\n        this.openNUSMODS = this.openNUSMODS.bind(this);\r\n        this.specialToggle = this.specialToggle.bind(this);\r\n        this.showSpecialModal = this.showSpecialModal.bind(this);\r\n        this.specialModalButton = this.specialModalButton.bind(this);\r\n        this.handleSpecialChange = this.handleSpecialChange.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        var database = fb.firestore();\r\n        const email = fb.auth().currentUser.email;\r\n        var graphData = database.collection('users').doc(email).get().then(doc => {\r\n            if (!doc.exists) {\r\n                console.log('No such document in database');\r\n            } else {\r\n                this.setState(prevState => {\r\n                    return {\r\n                        ...prevState,\r\n                        data2: doc.data().graphData,\r\n                        isLoading: false,\r\n                        data: doc.data().timelineData\r\n                    }\r\n                })\r\n            }\r\n        }).catch(err => { console.log('Error getting document')});\r\n    }\r\n\r\n    specialToggle() {\r\n        this.setState(prevState => {\r\n            return {\r\n                ...prevState,\r\n                showSpecialModal: null,\r\n                usefulTemp: []\r\n            }\r\n        })\r\n    }\r\n\r\n    specialModalButton(obj, event) {\r\n        event.preventDefault();\r\n        for (var exempted of this.state.usefulTemp) {\r\n            var done = false;\r\n            for (var node of this.state.data2.nodes) {\r\n                if (done) {\r\n                    break;\r\n                } else if (node.id === exempted) {\r\n                    this.addToTimeline(node.id, -1, -1);\r\n                    break;\r\n                } else {\r\n                    for (var nodeEquiv of node.equivalent) {\r\n                        if (nodeEquiv === exempted) {\r\n                            this.addToTimeline(node.id, -1, -1);\r\n                            done = true;\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.setState(prevState => {\r\n            return {\r\n                ...prevState,\r\n                showSpecialModal: null,\r\n                usefulTemp: []\r\n            }\r\n        })\r\n    }\r\n\r\n    handleSpecialChange(event) {\r\n        const name = event.target.name;\r\n        const checked = event.target.checked;\r\n        if (checked) {\r\n            this.setState(prevState => {\r\n                var newUsefulTemp = prevState.usefulTemp;\r\n                newUsefulTemp.push(name);\r\n                return {\r\n                    ...prevState,\r\n                    usefulTemp: newUsefulTemp\r\n                }\r\n            })\r\n        } else {\r\n            this.setState(prevState => {\r\n                const nameToBeRemoved = name;\r\n                var newUsefulTemp = [];\r\n                for (var n of prevState.usefulTemp) {\r\n                    if (n !== nameToBeRemoved) {\r\n                        newUsefulTemp.push(n);\r\n                    }\r\n                }\r\n                return {\r\n                    ...prevState,\r\n                    usefulTemp: newUsefulTemp\r\n                }\r\n            })\r\n        }\r\n        console.log(event.target.name);\r\n        console.log(event.target.checked);\r\n    }\r\n\r\n    showSpecialModal(obj) {\r\n        const required = [];\r\n        var counter = 0;\r\n        for (var req of obj.require) {\r\n            if (!req.unlocked) {\r\n                var temp = \"Any one of: \";\r\n                for (var i = 0; i < req.name.length; i = i + 1) {\r\n                    if (i != (req.name.length - 1)) {\r\n                        temp = temp + req.name[i] + \", \";\r\n                    } else {\r\n                        temp = temp + req.name[i]\r\n                    }\r\n                }\r\n                const htmlLayout = <FormGroup>\r\n                    <Label style={{marginLeft: '20px'}}>\r\n                        <Input type=\"checkbox\" name={req.name[0]} onChange={e => this.handleSpecialChange(e)}></Input>\r\n                        {temp}\r\n                    </Label>\r\n                </FormGroup>\r\n                required.push(htmlLayout);\r\n                counter = counter + 1;\r\n            }\r\n        }\r\n        return (\r\n            <Form style={{margin: '30px', textAlign:'justify'}} onSubmit={(e) => this.specialModalButton(obj, e)}>\r\n                <FormGroup style={{fontWeight: 'bold', fontSize: '18px'}}>{obj.id + \" - \" + obj.name}</FormGroup>\r\n                <FormGroup style={{fontWeight: 'bold', fontSize: '15px'}}>\r\n                    You have not unlocked all of the prerequisites for this module. To make an exception, select the module(s)\r\n                    from the following options that you have cleared or are exempted from. (E.g some ES modules)\r\n                </FormGroup>\r\n                {required}\r\n                <FormGroup>\r\n                    <Button type=\"submit\">Make this exception for me!</Button>\r\n                </FormGroup>\r\n            </Form>\r\n        )\r\n    }\r\n\r\n    toggleTimeline() {\r\n        this.setState(prevState => {\r\n            return {\r\n                ...prevState,\r\n                data: prevState.data,\r\n                showModal: false,\r\n                showTimeline: !prevState.showTimeline,\r\n                showSidebar: false,\r\n                addedList: prevState.addedList,\r\n                data2: prevState.data2\r\n            }\r\n        })\r\n    }\r\n\r\n    //Draws an empty cell containing a message (acts as a placeholder when timeline is empty)\r\n    drawEmptyCell(msg) {\r\n        const regex = /(NOC)|(Exchange)/g;\r\n        const finalizedMsg = msg === undefined ? undefined : (regex.test(msg) ? msg : msg + \" - \" + moduleDatabase[msg].name);\r\n        return <div class={msg === undefined ? \"cellBefore\" : regex.test(msg) ? \"cellSp\" : \"cellAfter\"}>{msg === undefined ? \"-Empty-\" : finalizedMsg}</div>;\r\n    }\r\n\r\n    //Adds <String> module, <Integer> year, <Integer> semester to the timeline\r\n    addToTimeline(module, year, semester){\r\n        this.setState(prevState => {\r\n            var updatedSemesterYear = 'y' + year + 's' + semester;\r\n            var updatedList = prevState.addedList.map(x => x);\r\n            updatedList.push(module);\r\n            for (var i = 0; i < prevState.data2.nodes.length; i = i + 1) {\r\n                if (prevState.data2.nodes[i].id === module) {\r\n                    prevState.data2.nodes[i].added = [year, semester];\r\n                }\r\n                var updateUnlock = prevState.data2.nodes[i].require;\r\n                for (var k = 0; k < updateUnlock.length; k = k + 1) {\r\n                    for (var p = 0; p < updateUnlock[k].name.length; p = p + 1) {\r\n                        if (updateUnlock[k].name[p] === module) {\r\n                            updateUnlock[k].unlocked = true;\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            var newState = { data : { }, addedList : updatedList, showTimeline: prevState.showTimeline, data2: prevState.data2 };\r\n            for(var i = 1; i <= 4; i = i + 1) {\r\n                for(var j = 1; j <= 2; j = j + 1) {\r\n                    var semesterYear = 'y' + i + 's' + j;\r\n                    if (semesterYear === updatedSemesterYear) {\r\n                        newState.data[semesterYear] = prevState.data[semesterYear].map(x => x);\r\n                        newState.data[semesterYear].push(module);\r\n                    } else {\r\n                        newState.data[semesterYear] = prevState.data[semesterYear].map(x => x);\r\n                    }\r\n                }\r\n            }\r\n            return newState;\r\n        })\r\n    }\r\n\r\n    //Removes <Object> module from the timeline\r\n    removeFromTimeline2(moduleObj) {\r\n        const moduleName = moduleObj.module;\r\n        const year = moduleObj.added[0];\r\n        const sem = moduleObj.added[1];\r\n        this.setState(prevState => {\r\n            var yearSem = 'y' + year + 's' + sem;\r\n            var newData = [];\r\n            for (var i = 0; i < this.state.data[yearSem].length; i = i + 1) {\r\n                if (this.state.data[yearSem][i] !== moduleName) {\r\n                    newData.push(this.state.data[yearSem][i]);\r\n                }\r\n            }\r\n            this.state.data[yearSem] = newData;\r\n            return {\r\n                ...prevState,\r\n                data: this.state.data\r\n            }\r\n        })\r\n    }\r\n\r\n    //Removes <String> module from the timeline\r\n    removeFromTimeline(module) {\r\n        var moduleObject = null;\r\n        for (var i = 0; i < this.state.data2.nodes.length; i = i + 1) {\r\n            if (this.state.data2.nodes[i].id === module) {\r\n                moduleObject = this.state.data2.nodes[i];\r\n                break;\r\n            }\r\n        }\r\n        if (moduleObject.added[0] === 0) { //Not in the timeline\r\n            return\r\n        } else {\r\n            moduleObject.added = [0,0];\r\n            this.setState(prevState => {\r\n                var updatedList = [];\r\n                for (var h = 0; h < prevState.data2.nodes.length; h = h + 1) {\r\n                    var updateUnlock = prevState.data2.nodes[h].require;\r\n                    for (var j = 0; j < updateUnlock.length; j = j + 1) {\r\n                        for (var k = 0; k < updateUnlock[j].name.length; k = k + 1) {\r\n                            if (updateUnlock[j].name[k] === module) {\r\n                                updateUnlock[j].unlocked = false;\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                for (var i = 0; i < prevState.addedList.length; i = i + 1) {\r\n                    if (!(prevState.addedList[i] === module)) {\r\n                        updatedList.push(prevState.addedList[i]);\r\n                    }\r\n                }\r\n                prevState.data2.module = false;\r\n                var newState = { ...prevState, data : { }, showTimeline: prevState.showTimeline, addedList: updatedList, data2: prevState.data2, showModal: false };\r\n                for(var i = 1; i <= 4; i = i + 1) {\r\n                    for(var j = 1; j <= 2; j = j + 1) {\r\n                        var semesterYear = 'y' + i + 's' + j;\r\n                        var k = 0;\r\n                        var temp = [];\r\n                        while (k < prevState.data[semesterYear].length) {\r\n                            if (!(prevState.data[semesterYear][k] === module)) {\r\n                                temp.push(prevState.data[semesterYear][k]);\r\n                            }\r\n                            k++;\r\n                        }\r\n                        newState.data[semesterYear] = temp;\r\n                    }\r\n                }\r\n                return newState;\r\n            })\r\n            for (var t = 0; t < this.state.data2.links.length; t = t + 1) {\r\n                if (this.state.data2.links[t].source === module) {\r\n                    this.removeFromTimeline(this.state.data2.links[t].target);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    //Finds and return the year and sem in the timeline returns: [year, semester]\r\n    findModule(module) {\r\n        var result = [ null, null ];\r\n        for (var i = 1; i <= 4; i = i + 1) {\r\n            for (var j = 1; j <= 2; j = j + 1) {\r\n                const semesterYear = 'y' + i + 's' + j;\r\n                for (var k = 0; k < this.state.data[semesterYear].length; k = k + 1) {\r\n                    if (this.state.data[semesterYear][k] === module) {\r\n                        result[0] = i;\r\n                        result[1] = j;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    //Modals\r\n    modalButton(module, year, semester) {\r\n        this.setState(prevState => {\r\n            return {\r\n                ...prevState,\r\n                data : prevState.data,\r\n                showModal : false,\r\n                showTimeline: false,\r\n                showSidebar: false,\r\n                config: prevState.config,\r\n                data2: prevState.data2,\r\n                addedList: prevState.addedList\r\n            }\r\n        })\r\n        this.addToTimeline(module, year, semester);\r\n        console.log(module, ' is added to year ' + year + ' sem ' + semester);\r\n    }\r\n\r\n    toggleModal() {\r\n        this.setState(prevState => {\r\n            return {\r\n                ...prevState,\r\n                data : prevState.data,\r\n                showModal : !prevState.showModal,\r\n                showTimeline: false,\r\n                showSidebar: false,\r\n                config: prevState.config,\r\n                data2: prevState.data2,\r\n                addedList : prevState.addedList\r\n            }\r\n        })\r\n    }\r\n\r\n    showEditForm(obj) {\r\n        const equivalentModules = obj.equivalent.map(mod => {\r\n          return (\r\n            <option value={mod}>{mod}</option>\r\n          )\r\n        })\r\n        return (\r\n            <Form>\r\n                <label>\r\n                {\"Not taking \" + obj.id + \"? Pick another equivalent module:\"} <br></br>\r\n                </label>\r\n                <Input type=\"select\" value={obj.id} onChange={e => this.handleOnChangeEditForm(obj, e)}>\r\n                    {equivalentModules}\r\n                </Input>\r\n            </Form>\r\n        )\r\n    }\r\n\r\n    handleOnChangeEditForm(object, event) {\r\n        //Must create constant to store value of event.target.value because it is asynchronous\r\n        const updatedName = event.target.value;\r\n        var modalObj = null;\r\n\r\n        this.setState(prevState => {\r\n          var updatedData = { nodes: prevState.data2.nodes.map(x => x), links: prevState.data2.links.map(x => x)};\r\n          for (var i = 0; i < updatedData.nodes.length; i = i + 1) {\r\n              if (updatedData.nodes[i].id === object.id) {\r\n                  updatedData.nodes[i] = {\r\n                      id: updatedName,\r\n                      x: updatedData.nodes[i].x,\r\n                      y: updatedData.nodes[i].y,\r\n                      equivalent: updatedData.nodes[i].equivalent,\r\n                      require: updatedData.nodes[i].require,\r\n                      added: [0,0],\r\n                      name: updatedData.nodes[i].name\r\n                  }\r\n                  modalObj = updatedData.nodes[i]\r\n                  break;\r\n              }\r\n          }\r\n          for (var i = 0; i < updatedData.links.length; i = i + 1) {\r\n                if (updatedData.links[i].source === object.id) {\r\n                    updatedData.links[i] = {\r\n                        source: updatedName,\r\n                        target: updatedData.links[i].target\r\n                    }\r\n                } else if (updatedData.links[i].target === object.id) {\r\n                    updatedData.links[i] = {\r\n                        source: updatedData.links[i].source,\r\n                        target: updatedName\r\n                    }\r\n                }                \r\n          }\r\n          return {\r\n            ...prevState,\r\n            data : prevState.data,\r\n            showModal : modalObj,\r\n            showTimeline: false,\r\n            showSidebar: false,\r\n            config: prevState.config,\r\n            data2: updatedData,\r\n            addedList: prevState.addedList\r\n        }})\r\n    }\r\n\r\n    //Helper function to generate buttons for showModal(obj)\r\n    generateButtons(yearSem, module) {\r\n        const result = [];\r\n        var flag = (yearSem[0] - 1) * 2 + yearSem[1];\r\n        var counter = 1;\r\n        var spProgram = [];\r\n        Object.keys(this.state.data).forEach(key => {\r\n            const regex = /(NOC)|(Exchange)/;\r\n            if (regex.test(this.state.data[key][0])) {\r\n                spProgram.push(key);\r\n            }\r\n        })\r\n        for (var i = 1; i <= 4; i = i + 1) {\r\n            for (var j = 1; j <= 2; j = j + 1) {\r\n                const ys = 'y' + i + 's' + j;\r\n                if ((counter > flag) && !spProgram.includes(ys)) {\r\n                    //show clickable button\r\n                    const year = i;\r\n                    const sem = j;\r\n                    const btn = <Button onClick={() => this.modalButton(module, year, sem)}>{\"Year \" + year + \" Sem \" + sem}</Button>;\r\n                    result.push(btn);\r\n                } else {\r\n                    const year = i;\r\n                    const sem = j;\r\n                    const btn = <Button disabled>{\"Year \" + year + \" Sem \" + sem}</Button>;\r\n                    result.push(btn);\r\n                }\r\n                counter = counter + 1;\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    showModal(obj) {\r\n        const module = obj.id;\r\n        var latestPrereqYearSem = [0,0];\r\n        for (var k = 0; k < obj.require.length; k = k + 1) {\r\n            var preReqList = obj.require[k];\r\n            for (var j = 0; j < preReqList.name.length; j = j + 1) {\r\n                var preReq = preReqList.name[j];\r\n                for (var i = 0; i < this.state.data2.nodes.length; i = i + 1) {\r\n                    var moduleObj = this.state.data2.nodes[i];\r\n                    if (moduleObj.id === preReq) {\r\n                        console.log(moduleObj.id, ' added to ', moduleObj.added);\r\n                        const yearSemAdded = moduleObj.added;\r\n                        latestPrereqYearSem = latestPrereqYearSem[0] > yearSemAdded[0] ?\r\n                            latestPrereqYearSem : latestPrereqYearSem[0] < yearSemAdded[0] ?\r\n                            yearSemAdded : latestPrereqYearSem[1] > yearSemAdded[1] ?\r\n                            latestPrereqYearSem : yearSemAdded;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        console.log(latestPrereqYearSem);\r\n        if (obj.added[0] === 0) {\r\n            return (<div class=\"modal-content\" id={\"myModal\" + obj.id}>\r\n                    <ModalHeader toggle={this.toggleModal}>{obj.id + ' - ' + obj.name}</ModalHeader>\r\n                    <div class=\"modal-msg\">\r\n                    {this.showEditForm(obj)}\r\n                    </div>\r\n                    <Container>\r\n                        <Row className=\"Info\">\r\n                            <Col>\r\n                            <div class=\"modalMoreInfo\" onClick={() => this.openNUSMODS(obj)}>\r\n                                    Get more information about this module here!\r\n                            </div>\r\n                            </Col>\r\n                            <Col>\r\n                                <div style={{marginBottom: 10}}>{\"Add \" + module + \" to?\"}</div>\r\n                                <div class=\"modalButtons\">\r\n                                    {this.generateButtons(latestPrereqYearSem, module)}\r\n                                </div> \r\n                            </Col>\r\n                        </Row>\r\n                    </Container>\r\n                    \r\n                </div>\r\n            );\r\n        } else {\r\n            const future = [];\r\n            for (var link of this.state.data2.links) {\r\n                if (link.source === obj.id) {\r\n                    future.push(link.target);\r\n                }\r\n            }\r\n            var ys = [];\r\n            for (var futureMod of future) {\r\n                for (var node of this.state.data2.nodes) {\r\n                    if (node.id === futureMod) {\r\n                        const futureAdd = node.added;\r\n                        if (futureAdd[0] !== 0) {\r\n                            ys.push(futureAdd);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            var buttonRes = [5,5];\r\n            if (ys.length > 0) {\r\n                for (var addedPeriod of ys) {\r\n                    buttonRes = buttonRes[0] > addedPeriod[0] ? addedPeriod\r\n                                : (buttonRes[0] === addedPeriod[0] ? (buttonRes[1] > addedPeriod[1] ? addedPeriod : buttonRes)\r\n                                : buttonRes)\r\n                }\r\n            }\r\n            var buttons = [];\r\n            var marked = false;\r\n            const regex = /(NOC)|(Exchange)/;\r\n            for (var i = 1; i <= 4; i = i + 1) {\r\n                for (var j = 1; j <= 2; j = j + 1) {\r\n                    const yrSem = 'y' + i + 's' + j;\r\n                    console.log(yrSem + ' ' + this.state.data[yrSem][0])\r\n                    if (marked || regex.test(this.state.data[yrSem][0])) {\r\n                        const btn = <Button disabled>{\"Year \" + i + \" Sem \" + j}</Button>\r\n                        buttons.push(btn);\r\n                    } else {\r\n                        if (i === buttonRes[0] && j === buttonRes[1]) {\r\n                            marked = true;\r\n                            const btn = <Button disabled>{\"Year \" + i + \" Sem \" + j}</Button>\r\n                            buttons.push(btn);\r\n                        } else {\r\n                            const year = i;\r\n                            const sem = j;\r\n                            const btnFunc = () => {\r\n                                const modObj = {\r\n                                    module: obj.id,\r\n                                    added: obj.added\r\n                                }\r\n                                this.removeFromTimeline2(modObj);\r\n                                this.addToTimeline(obj.id, year, sem);\r\n                                this.setState(prevState => {\r\n                                    return {\r\n                                        ...prevState,\r\n                                        showModal: false\r\n                                    }\r\n                                })\r\n                            }\r\n                            const btn = <Button onClick={btnFunc}>{\"Year \" + i + \" Sem \" + j}</Button>\r\n                            buttons.push(btn);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return (<div class=\"modal-content\" id={\"myModal\" + obj.id}>\r\n                <ModalHeader toggle={this.toggleModal}>{obj.id + ' - ' + obj.name}</ModalHeader>\r\n                <ModalBody>\r\n                    <div>{obj.added[0] === -1 ? \"You are exempted/ have cleared this module requirement. Do you want to remove your exemption?\" : \"Remove \" + obj.id + \" from year \" + obj.added[0] + \" semester \" + obj.added[1] + \"?\"}</div>\r\n                    <div>{\"WARNING: any modules that require \" + obj.id + \" will be removed from the timeline as well!\"}</div>\r\n                    <div>{\"Alternatively you can change the timeline slot for \" + obj.id}</div>\r\n                </ModalBody>\r\n                <ModalFooter>\r\n                    <div style={{display:'grid', gridTemplateColumns: '1fr 1fr', width: '100%', alignItems:'center'}}>\r\n                         <div>Remove module? <br></br><Button style={{marginTop: '10px'}} onClick={() => this.removeFromTimeline(obj.id)}>Remove</Button></div>\r\n                         <div>\r\n                             Change to which year/sem?\r\n                             <div style={{marginTop: '10px', display: 'grid', gridTemplateColumns: '1fr 1fr', width: '100%', gridGap: '7px'}}>\r\n                                {buttons}\r\n                             </div>\r\n                         </div>\r\n                    </div>\r\n                </ModalFooter>\r\n            </div>);\r\n        }\r\n    }\r\n\r\n    openNUSMODS(obj) {\r\n        const url = \"https://nusmods.com/modules/\" + obj.id;\r\n        window.open(url);\r\n    }\r\n\r\n    drawTable(year) {\r\n        const yearSem1 = \"y\" + year + \"s\" + 1;\r\n        const yearSem2 = \"y\" + year + \"s\" + 2;\r\n        const regex = /(NOC)|(Exchange)/;\r\n        const spProgStyles = {\r\n            verticalAlign: 'middle',\r\n            fontSize: '50px',\r\n            fontWeight: 'bolder'\r\n        }\r\n        const rowSpanSize = this.state.data[yearSem1].length > this.state.data[yearSem2].length ?\r\n            ((this.state.data[yearSem1].length > 5) ? this.state.data[yearSem1].length : 5) :\r\n            ((this.state.data[yearSem2].length > 5) ? this.state.data[yearSem2].length : 5)\r\n        if (regex.test(this.state.data[yearSem1][0]) && regex.test(this.state.data[yearSem2][0])) {\r\n            //Entire year which user will be or have went to special programmes (NOC/Exchange)\r\n            return ([<tr>\r\n                <th style={{verticalAlign: 'middle'}}>{\"Year \" + year}</th>\r\n                <td style={spProgStyles}>{this.drawEmptyCell(this.state.data[yearSem1][0])}</td>\r\n                <td style={spProgStyles}>{this.drawEmptyCell(this.state.data[yearSem2][0])}</td>\r\n              </tr>,\r\n              ]);\r\n        } else if (regex.test(this.state.data[yearSem1][0])) {\r\n            //sem1 of the year which user will be or have went to special programmes (NOC/Exchange)\r\n            var result = [<tr>\r\n                <th style={{verticalAlign: 'middle'}} rowSpan={rowSpanSize}>{\"Year \" + year}</th>\r\n                <td style={spProgStyles} rowSpan={rowSpanSize}>{this.drawEmptyCell(this.state.data[yearSem1][0])}</td>\r\n                <td style={{verticalAlign: 'middle'}}>{this.drawEmptyCell(this.state.data[yearSem2][0])}</td>\r\n              </tr>,\r\n              <tr>\r\n                  <td>{this.drawEmptyCell(this.state.data[yearSem2][1])}</td>\r\n              </tr>,\r\n              <tr>\r\n                  <td>{this.drawEmptyCell(this.state.data[yearSem2][2])}</td>\r\n              </tr>,\r\n              <tr>\r\n                  <td>{this.drawEmptyCell(this.state.data[yearSem2][3])}</td>\r\n              </tr>,\r\n              <tr>\r\n                  <td>{this.drawEmptyCell(this.state.data[yearSem2][4])}</td>\r\n              </tr>\r\n              ];\r\n              for (var i = 5; i < rowSpanSize; i = i + 1) {\r\n                  const tableRow =<tr>\r\n                      <td>{this.drawEmptyCell(this.state.data[yearSem2][i])}</td>\r\n                  </tr>\r\n                  result.push(tableRow);\r\n              }\r\n              return result;\r\n        } else if (regex.test(this.state.data[yearSem2][0])) {\r\n            //sem2 of the year which user will be or have went to special programmes (NOC/Exchange)\r\n            var result = [<tr>\r\n                <th style={{verticalAlign: 'middle'}} rowSpan={rowSpanSize}>{\"Year \" + year}</th>\r\n                <td>{this.drawEmptyCell(this.state.data[yearSem1][0])}</td>\r\n                <td style={spProgStyles} rowSpan={rowSpanSize}>{this.drawEmptyCell(this.state.data[yearSem2][0])}</td>\r\n              </tr>,\r\n              <tr>\r\n                  <td>{this.drawEmptyCell(this.state.data[yearSem1][1])}</td>\r\n              </tr>,\r\n              <tr>\r\n                  <td>{this.drawEmptyCell(this.state.data[yearSem1][2])}</td>\r\n              </tr>,\r\n              <tr>\r\n                  <td>{this.drawEmptyCell(this.state.data[yearSem1][3])}</td>\r\n              </tr>,\r\n              <tr>\r\n                  <td>{this.drawEmptyCell(this.state.data[yearSem1][4])}</td>\r\n              </tr>\r\n              ];\r\n\r\n              for (var i = 5; i < rowSpanSize; i = i + 1) {\r\n                const tableRow = <tr>\r\n                    <td>{this.drawEmptyCell(this.state.data[yearSem1][i])}</td>\r\n                </tr>\r\n                result.push(tableRow);\r\n              }\r\n              return result;\r\n        } else {\r\n            var result = [<tr>\r\n                <th style={{verticalAlign: 'middle'}} rowSpan={rowSpanSize}>{\"Year \" + year}</th>\r\n                <td>{this.drawEmptyCell(this.state.data[yearSem1][0])}</td>\r\n                <td>{this.drawEmptyCell(this.state.data[yearSem2][0])}</td>\r\n              </tr>,\r\n              <tr>\r\n                  <td>{this.drawEmptyCell(this.state.data[yearSem1][1])}</td>\r\n                  <td>{this.drawEmptyCell(this.state.data[yearSem2][1])}</td>\r\n              </tr>,\r\n              <tr>\r\n                  <td>{this.drawEmptyCell(this.state.data[yearSem1][2])}</td>\r\n                  <td>{this.drawEmptyCell(this.state.data[yearSem2][2])}</td>\r\n              </tr>,\r\n              <tr>\r\n                  <td>{this.drawEmptyCell(this.state.data[yearSem1][3])}</td>\r\n                  <td>{this.drawEmptyCell(this.state.data[yearSem2][3])}</td>\r\n              </tr>,\r\n              <tr>\r\n                  <td>{this.drawEmptyCell(this.state.data[yearSem1][4])}</td>\r\n                  <td>{this.drawEmptyCell(this.state.data[yearSem2][4])}</td>\r\n              </tr>\r\n              ];\r\n              for (var i = 5; i < rowSpanSize; i = i + 1) {\r\n                  const tableRow = <tr>\r\n                    <td>{this.drawEmptyCell(this.state.data[yearSem1][i])}</td>\r\n                    <td>{this.drawEmptyCell(this.state.data[yearSem2][i])}</td>\r\n                  </tr>\r\n                  result.push(tableRow);\r\n              }\r\n              return result;\r\n        }\r\n    }\r\n\r\n    drawGraph() {\r\n        this.state.config.node.viewGenerator = ((info) => <CustomNode info={info} addToTimeline={this.addToTimeline} removeFromTimeline={this.removeFromTimeline} findModule={this.findModule}/>);\r\n        /*for (var node of this.state.data2.nodes) {\r\n            var unlocked = true;\r\n            for (var req of node.require) {\r\n                if (!req.unlocked) {\r\n                    unlocked = false;\r\n                }\r\n            }\r\n            if (unlocked) {\r\n                node.size = 800;\r\n            } else {\r\n                node.size = 600;\r\n            }\r\n        }*/\r\n        var format = <div class=\"MODGrid\">\r\n                <Graph ref=\"graph\" {...{\r\n                    id: \"graph\",\r\n                    data: this.state.data2,\r\n                    config: this.state.config,\r\n                    onClickNode: this.onClickNode,\r\n                    onDoubleClickNode: this.onDoubleClickNode,\r\n                    onClickGraph: this.onClickGraph\r\n                }} />\r\n            </div>;\r\n        return format;\r\n    }\r\n\r\n    //User interaction with graph\r\n\r\n    onClickNode = id => {\r\n        var obj = null;\r\n        for (var i = 0; i < this.state.data2.nodes.length; i = i + 1) {\r\n            if (this.state.data2.nodes[i].id === id) {\r\n                obj = this.state.data2.nodes[i];\r\n                break;\r\n            }\r\n        }\r\n        var willDisplayModal = true\r\n        for (var i = 0; i < obj.require.length; i = i + 1) {\r\n            if (!obj.require[i].unlocked) {\r\n                willDisplayModal = false;\r\n                break;\r\n            }\r\n        }\r\n        if (!willDisplayModal) {\r\n            this.setState(prevState => {\r\n                return {\r\n                    ...prevState,\r\n                    showSpecialModal: obj\r\n                }\r\n            })\r\n        } else {\r\n            this.setState(prevState => {\r\n                return {\r\n                    data : prevState.data,\r\n                    showModal : obj,\r\n                    showTimeline: false,\r\n                    showSidebar: false,\r\n                    config: prevState.config,\r\n                    data2: prevState.data2\r\n                }\r\n            })\r\n        }\r\n    };\r\n\r\n    render() {\r\n        const screenHeight = window.screen.height;\r\n        const screenWidth = window.screen.width;\r\n        return (\r\n            <div class={this.props.className}>\r\n                <Modal isOpen={this.state.showModal === false ? false : true} toggle={this.toggleModal}>\r\n                    {this.state.showModal === false ? null : this.showModal(this.state.showModal)}\r\n                </Modal>\r\n                <Modal isOpen={this.state.showSpecialModal === null ? false : true} toggle={this.specialToggle}>\r\n                    {this.state.showSpecialModal === null ? null : this.showSpecialModal(this.state.showSpecialModal)}\r\n                </Modal>\r\n                <Topbar toggleTimeline={this.toggleTimeline} graphData={this.state.data2} getTimelineData={() => this.state.data} timelineData={this.state.data} addToTimeline={this.addToTimeline} removeFromTimeline={this.removeFromTimeline2}/>\r\n                {this.state.isLoading ? null //(<div style={{display: 'flex', alignItems: 'center'}}><Spinner style={{ width: '100px', height: '100px' }} color=\"light\" /></div>)\r\n                : (<div class=\"MODGrid\">\r\n                    {this.drawGraph()}\r\n                </div>)}\r\n                <Modal isOpen={this.state.showTimeline} overlayClassName=\"modal-bg\" toggle={this.toggleTimeline}>\r\n                    {\r\n                    this.state.showTimeline ?\r\n                    <div>\r\n                    <Table dark striped size=\"sm\" bordered style={{margin: 0}}>\r\n                        <thead>\r\n                            <tr>\r\n                                <th>Timeline</th>\r\n                                <th>Semester 1</th>\r\n                                <th>Semester 2</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {this.drawTable(1)}\r\n                            {this.drawTable(2)}\r\n                            {this.drawTable(3)}\r\n                            {this.drawTable(4)}\r\n                        </tbody>\r\n                    </Table>\r\n                    </div>\r\n                    : null\r\n                    }\r\n                </Modal>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default Timeline;"]},"metadata":{},"sourceType":"module"}